## 计算机网络

### OSI七层模型和TCP/IP四层模型的区别

#### OSI七层模型

1. **应用层（Application Layer）**：用户直接与之交互的层，提供网络服务和应用程序接口。常见协议包括HTTP、FTP、SMTP等。
2. **表示层（Presentation Layer）**：负责数据格式转换、加密和解密，以及数据压缩等。它确保应用层可以理解数据格式。
3. **会话层（Session Layer）**：管理会话的建立、维护和终止，负责在不同设备之间建立、管理和终止通信会话。
4. **传输层（Transport Layer）**：负责端到端的数据传输，提供可靠性和流量控制。常见协议有TCP（传输控制协议）和UDP（用户数据报协议）。
5. **网络层（Network Layer）**：负责数据包的路由选择和传输。它处理IP地址，并负责将数据从源地址发送到目标地址。常见协议包括IP（互联网协议）和ICMP（互联网控制消息协议）。
6. **数据链路层（Data Link Layer）**：负责在物理链路上提供可靠的数据传输，处理物理地址（MAC地址）以及错误检测和纠正。常见协议包括Ethernet和PPP（点对点协议）。
7. **物理层（Physical Layer）**：负责物理介质的传输，包括电缆、光纤、无线信号等。它定义了硬件设备的物理特性，如电压、信号频率、传输速率等。

#### TCP/IP四层模型

1. **应用层（Application Layer）**：类似于OSI模型的应用层，负责应用程序的网络服务。常见协议包括HTTP、SMTP、FTP、DNS等。
2. **传输层（Transport Layer）**：与OSI的传输层相同，负责端到端的数据传输，提供可靠性和流量控制。常见协议包括TCP和UDP。
3. **网络层（Internet Layer）**：类似于OSI的网络层，负责数据包的路由和传输。主要协议为IP（互联网协议），还有ICMP（互联网控制消息协议）。
4. **网络接口层（Network Interface Layer）**：相当于OSI的物理层和数据链路层，负责在物理介质上发送和接收数据，处理物理地址（如MAC地址）。

| **比较点**   | **OSI 七层模型**         | **TCP/IP 四层模型**                     |
| ------------ | ------------------------ | --------------------------------------- |
| **层数**     | 7 层                     | 4 层                                    |
| **实际应用** | 理论模型，少量实际应用   | 实际网络通信模型，广泛应用于互联网      |
| **协议标准** | 理论为主，未具体绑定协议 | 实际协议标准，如 IP、TCP、UDP、HTTP 等  |
| **功能划分** | 细致，强调各层功能       | 简化，重点放在传输和网络功能            |
| **层次合并** | 层次独立性强             | 将 OSI 中的会话、表示、应用层合并为一层 |
| **历史背景** | 由 ISO 提出，发展缓慢    | 随着互联网发展，成为主流模型            |

### 应用层常见协议

- HTTP（Hypertext Transfer Protocol，超文本传输协议）：基于 TCP 协议，是一种用于传输超文本和多媒体内容的协议，主要是为 Web 浏览器与 Web 服务器之间的通信而设计的。当我们使用浏览器浏览网页的时候，我们的网页就是通过 HTTP 请求进行加载的。
- SMTP（Simple Mail Transfer Protocol，简单邮件发送协议）：基于 TCP 协议，是一种用于发送电子邮件的协议。注意⚠：SMTP 协议只负责邮件的发送，而不是接收。要从邮件服务器接收邮件，需要使用 POP3 或 IMAP 协议。
- POP3/IMAP（邮件接收协议）：基于 TCP 协议，两者都是负责邮件接收的协议。IMAP 协议是比 POP3 更新的协议，它在功能和性能上都更加强大。IMAP 支持邮件搜索、标记、分类、归档等高级功能，而且可以在多个设备之间同步邮件状态。几乎所有现代电子邮件客户端和服务器都支持 IMAP。
- FTP（File Transfer Protocol，文件传输协议）：基于 TCP 协议，是一种用于在计算机之间传输文件的协议，可以屏蔽操作系统和文件存储方式。注意⚠：FTP 是一种不安全的协议，因为它在传输过程中不会对数据进行加密。建议在传输敏感数据时使用更安全的协议，如 SFTP。
- Telnet（远程登陆协议）：基于 TCP 协议，用于通过一个终端登陆到其他服务器。Telnet 协议的最大缺点之一是所有数据（包括用户名和密码）均以明文形式发送，这有潜在的安全风险。这就是为什么如今很少使用 Telnet，而是使用一种称为 SSH 的非常安全的网络传输协议的主要原因。
- SSH（Secure Shell Protocol，安全的网络传输协议）：基于 TCP 协议，通过加密和认证机制实现安全的访问和文件传输等业务。
- RTP（Real-time Transport Protocol，实时传输协议）：通常基于 UDP 协议，但也支持 TCP 协议。它提供了端到端的实时传输数据的功能，但不包含资源预留和不保证实时传输质量，这些功能由 WebRTC 实现。
- DNS（Domain Name System，域名管理系统）：基于 UDP 协议，用于解决域名和 IP 地址的映射问题。

### 访问网页的全过程

1. 输入URL
2. DNS解析域名
3. 建立TCP连接
4. 浏览器发送HTTP(S)请求
5. 服务器接受请求，返回相应给浏览器
6. 浏览器获取响应，解析响应体中的HTML代码，渲染页面的结构和样式
7. 不需要与服务器通信时，主动关闭TCP连接

### DNS协议

目前 DNS 的设计采用的是分布式、层次数据库结构，**DNS 是应用层协议，基于 UDP 协议之上，端口为 53** 。

#### DNS服务器

1. **根域名服务器（Root Name Servers）**

   根域名服务器位于DNS层级的最顶层，负责维护所有顶级域（TLD）的信息。全球有13个根域名服务器，使用字母标识（如A根服务器、B根服务器等）。根服务器的主要作用是接收查询请求，并指向相应的TLD服务器。

2. **顶级域名服务器（TLD Name Servers）**

   顶级域名服务器负责特定顶级域（如.com、.org、.net等）的管理。每个TLD有多个冗余的TLD服务器。当根服务器接收到域名解析请求时，它会将请求转发到对应的TLD服务器，TLD服务器再进一步处理该请求。

3. **权威域名服务器（Authoritative Name Servers）**

   权威域名服务器存储域名及其对应的IP地址信息。它们负责将特定域名（如example.com）解析为IP地址。权威DNS服务器可分为主DNS服务器和从DNS服务器：

   - **主DNS服务器**：存储域名的原始数据，并可进行更新。

   - **从DNS服务器**：从主DNS服务器获取数据，并提供冗余，以提高可用性。

4. **缓存DNS服务器（Caching Name Servers）**

   缓存DNS服务器（通常由ISP提供）存储先前查询的域名解析结果，以加速后续请求的响应。当用户请求解析某个域名时，缓存DNS服务器会首先检查自己的缓存，如果缓存中没有相应记录，则向根服务器或权威服务器查询。

5. **本地DNS解析器（Local DNS Resolvers）**

   本地DNS解析器是用户计算机或网络设备中运行的DNS客户端。它们发起DNS查询请求，通常由ISP提供的缓存DNS服务器处理。解析器会根据查询的结果将域名转换为IP地址，以便进行网络通信。

#### 自底向上的DNS解析流程

1. 用户输入网址（如www.example.com），本地DNS解析器首先检查本地缓存。
2. 如果缓存中没有记录，本地解析器向缓存DNS服务器发送查询请求。
3. 缓存DNS服务器查询根域名服务器，获取对应TLD服务器的地址。
4. 然后，它向相应的TLD服务器发送请求，获取权威域名服务器的地址。
5. 最后，向权威域名服务器发送请求，获得该域名的IP地址。
6. IP地址返回给缓存DNS服务器，缓存DNS服务器将结果返回给本地DNS解析器，最后本地解析器将结果返回给用户的设备。

### TCP三次握手和四次挥手

#### 为什么不是两次或四次握手

- **为什么不能是两次握手？**（**半连接**导致数据丢失）

  如果是两次握手，服务器收到客户端的请求后回复确认，但客户端并没有确认服务器的应答，那么服务器并不能确定客户端是否已准备好接收数据。比如，客户端的应答可能丢失，服务器就无法得知客户端是否准备好开始通信，导致可能发送的数据没有被客户端正确接收。

  两次握手无法确保双方都处于“准备好”状态，可能会引发通信不一致的问题。因此，两次握手不够可靠。

- **为什么不用四次握手？**

  四次握手其实是没有必要的。**三次握手已经完成了双方收发能力的确认**，第四次的额外确认会带来不必要的延迟和通信开销，而没有实质性作用。

[TCP 三次握手和四次挥手（传输层） | JavaGuide](https://javaguide.cn/cs-basics/network/tcp-connection-and-disconnection.html#断开连接-tcp-四次挥手)