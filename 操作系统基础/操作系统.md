## 死锁

### 产生死锁的条件

1. **互斥**：资源必须处于非共享模式，即一次只有一个进程可以使用。如果另一进程申请该资源，那么必须等待直到该资源被释放为止。
2. **占有并等待**：一个进程至少应该占有一个资源，并等待另一资源，而该资源被其他进程所占有。
3. **非抢占**：资源不能被抢占。只能在持有资源的进程完成任务后，该资源才会被释放。
4. **循环等待**：有一组等待进程 `{P0, P1,..., Pn}`， `P0` 等待的资源被 `P1` 占有，`P1` 等待的资源被 `P2` 占有，……，`Pn-1` 等待的资源被 `Pn` 占有，`Pn` 等待的资源被 `P0` 占有。

### 解除死锁的方法

- **破坏互斥条件**：如果可以的话，让资源变为共享资源（非独占）；或者直接使用无锁机制，如 Java 中的 `AtomicInteger` 等。通过原子操作实现并发控制，不必锁定资源。
- **破坏占有并等待条件**：要求线程一次性申请所需的所有资源，或使用银行家算法。
  - **银行家算法：**在每次资源分配前检查是否会导致系统进入不安全状态，从而避免死锁的发生。

- **破坏不可剥夺条件**：允许抢占资源，强制释放已经占用的资源。
- **破坏循环等待条件**：通过按顺序申请资源，避免循环等待。

