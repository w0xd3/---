> 这次问的很有难度很有深度

#### 需要深入学习的清单

1. JVM实际使用。感觉shopee很关注内存相关的东西
2. 对压力测试方法更深入的学习
3. JWT更深入的了解。refresh token、怎么清退token
4. AI prompt（想问 但是我没了解）
5. 多关注自己项目的技术难点，深挖怎么做会更好

#### 建议

1. 压力测试方面。怎么分析系统瓶颈，建议指标量化，怎么输出一份合格的压力测试报告。

### 压力测试分析系统瓶颈步骤

1. 收集分析目标
2. 进行压力测试
3. 收集和分析监控数据
4. 识别瓶颈
5. 压力测试报告分析
6. 优化后再次分析

#### 收集和分析监控数据

1. **CPU使用率**：高CPU使用率可能意味着应用程序或数据库的计算资源不足。
2. **内存使用**：内存使用过高可能表明存在内存泄漏或内存不足的情况。
3. **磁盘I/O**：磁盘读写操作的瓶颈通常会导致性能下降，特别是当应用需要频繁读写磁盘时。
4. **网络带宽和延迟**：网络带宽限制或高延迟可能导致响应速度变慢，影响整体性能。
5. **数据库指标**：数据库查询响应时间、连接池使用情况、锁竞争等。
6. **应用日志**：查看应用日志以捕捉异常或错误信息，帮助识别潜在问题。

#### 识别瓶颈——消息队列

**指标：**



#### 识别瓶颈——拓展

**CPU瓶颈**

- **症状**：CPU使用率接近100%，响应时间变长。
- **分析方法**：查看CPU使用情况，分析是某个进程还是多个进程占用过多CPU。使用 `top` 或 `htop` 命令可以帮助你查看哪个进程占用了最多的CPU资源。
- 可能原因：
  - 计算密集型操作，如数据处理、加密、解密、算法计算等。
  - 线程竞争，多个线程并行执行时导致上下文切换频繁，影响性能。
- 解决方法：
  - 优化计算密集型代码。
  - 使用合适的线程池管理线程。
  - 使用更高效的算法或数据结构。

**内存瓶颈**

- **症状**：内存使用率过高，系统发生频繁的垃圾回收（GC），或者出现OutOfMemoryError。
- **分析方法**：使用 `jconsole`、`VisualVM` 等工具来查看JVM的内存使用情况，特别是堆内存和非堆内存的使用情况。
- 可能原因：
  - 内存泄漏，导致内存占用越来越多。
  - 大量对象的创建和销毁，导致GC频繁。
- 解决方法：
  - 优化对象创建和销毁的逻辑，减少不必要的内存分配。
  - 使用对象池来复用对象。
  - 调整JVM的堆内存大小，或优化GC策略。

**磁盘I/O瓶颈**

- **症状**：磁盘读写速度慢，导致请求的处理时间增加。
- **分析方法**：通过监控磁盘I/O使用情况（例如，`iostat` 或 `sar` 命令）来确定是否存在磁盘瓶颈。
- 可能原因：
  - 磁盘写入操作频繁（如日志写入、数据写入数据库）。
  - 低性能的磁盘（如使用机械硬盘而非固态硬盘 SSD）。
  - 大量的并发请求导致磁盘读写超载。
- 解决方法：
  - 优化磁盘读写操作，减少不必要的文件操作。
  - 使用高速SSD替代传统的机械硬盘。
  - 使用缓存来减少频繁的磁盘访问。

**网络瓶颈**

- **症状**：网络延迟增加，吞吐量下降。
- **分析方法**：查看网络带宽和延迟，使用工具如 `ping`、`netstat`、`iftop` 或 `nload` 来分析网络流量。
- 可能原因：
  - 网络带宽限制，导致数据传输速度慢。
  - 网络拥塞或丢包。
  - 大量的外部API调用或资源请求。
- 解决方法：
  - 提高网络带宽或使用CDN来加速静态资源加载。
  - 优化网络请求，减少不必要的外部请求。
  - 使用负载均衡器分散流量。

**数据库瓶颈**

- **症状**：数据库查询响应时间长，导致应用响应时间增加。
- **分析方法**：使用数据库性能分析工具（如 `MySQL EXPLAIN`、`pg_stat_statements`）来检查慢查询和数据库负载。
- 可能原因：
  - 慢查询、没有索引的查询、全表扫描。
  - 数据库连接池过小，导致连接频繁创建和销毁。
  - 锁竞争导致的性能瓶颈。
- 解决方法：
  - 优化SQL查询，添加合适的索引。
  - 调整数据库连接池的配置。
  - 使用数据库分库分表，减少单一数据库的负载。

**应用程序瓶颈**

- **症状**：请求处理时间过长，无法及时响应。
- **分析方法**：查看应用程序日志、代码执行时间以及数据库访问日志，找出耗时的操作。
- 可能原因：
  - 不合理的业务逻辑，导致某些操作耗时。
  - 未优化的第三方库或框架，导致性能下降。
  - 应用程序配置不当（如线程池配置、缓存配置等）。
- 解决方法：
  - 对业务逻辑进行优化，避免不必要的计算或IO操作。
  - 使用缓存优化性能，避免频繁的数据库查询。
  - 调整应用程序的线程池和连接池配置。